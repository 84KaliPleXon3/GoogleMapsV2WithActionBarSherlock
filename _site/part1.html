<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Googlemapsv2withactionbarsherlock : This is a skeleton project for using Google Maps v2 on Android with ActionBarSherlock 4.3.1" />

    <link rel="stylesheet" type="text/css" media="screen" href="./stylesheets/stylesheet2.css">

    <title>Googlemapsv2withactionbarsherlock</title>
  </head>

  <body>
  
<a href="https://github.com/ddewaele/GoogleMapsV2WithActionBarSherlock"><img style="position: absolute; top: 0; right: 0; border: 0; -webkit-box-shadow: 0 0 0; box-shadow: 0 0 0; padding:0; margin:0" src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub"></a>

    <!-- HEADER -->
    <div id="header_wrap" class="outer" style="background: url(./images/backdrop.png) center no-repeat;
">

          <h1 id="project_title"><a href="./" style="color:#FFFFFF">Maps V2 Android</a></h1>
          <div id="project_tagline">
              Guide for the new Android Maps V2 API.
              Includes a sample app, full source code, screencast and guides.
          </div>

        <header class="inner">
          <a id="forkme_banner" href="https://github.com/ddewaele/GoogleMapsV2WithActionBarSherlock">View on GitHub</a>


            <!--
            <section id="downloads">
              
              <a class="zip_download_link" href="https://github.com/ddewaele/GoogleMapsV2WithActionBarSherlock/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/ddewaele/GoogleMapsV2WithActionBarSherlock/tarball/master">Download this project as a tar.gz file</a>
            
            </section>
            -->
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
	<h2 id='part_1__setting_up_the_project'>Part 1 : Setting up the project.</h2>

<h3 id='introduction'>Introduction</h3>

<p>In the first part of this tutorial I will show you can start using Google Maps Android API v2 in your Android application. The goal is to create a skeleton project that</p>

<ul>
<li>is capable of displaying a map using the new Google Map for Android API v2</li>

<li>uses ActionBarSherlock.</li>

<li>can run on older versions of Android (2.x and up).</li>
</ul>

<p>I&#8217;ve also created a screencast that covers setting up a skeleton project (not covering ActionBarSherlock).</p>
<iframe frameborder='0' width='560' height='315' src='//www.youtube.com/embed/Iz5cfPV200E?rel=0&&vq=hd720'> </iframe>
<h3 id='google_maps_android_api_v2'>Google Maps Android API v2</h3>

<p>The new Google Maps Android API v2 (available through Google Play Services) is a vast improvement over the original one and comes with many new features. Not only does it really stand out from a UI perspective but also on an API level can the new Maps v2 library be considered a &#8220;delight&#8221; for both end-users and developers.</p>

<p>Before the Google Maps Android API v2 was released, developers were forced to embed a <code>MapView</code> component in a special type of Activity called a <code>MapActivity</code>.</p>

<p>When developers created map applications using the MapView component, the maps embedded in these third party applications were not of the same standard as the ones that you found on the Google Maps application. Not only were the tiles of much higher quality in the Google Maps application, but subtle differences like auto-orienting street-names and labels that were present in the Google Maps application were not available in the MapView component. So effectivly, developers were left with a lower quality map component.</p>

<p>The <code>MapView</code> component also had several limitations. You could use 1 <code>MapView</code> component in your application and there was no <code>Fragment</code> support.</p>

<p>This has all changes with the new Google Maps Android v2 API.</p>

<p>A quick overview of the features of the new Maps Android API v2:</p>

<ul>
<li>Distribution via Google Play Services (no more waiting for Android platform updates to get new functionality)</li>

<li>Full fragment support (no more MapView, no more single map / app limitation)</li>

<li>New Map look and feel (new tiles, new gestures, 3D support &#8230;.)</li>
</ul>

<p>In the first part of this series I will show you how to</p>

<ul>
<li>setup the skeleton project</li>

<li>install the library projecs</li>

<li>setup your map key</li>

<li>add the map to your application.</li>

<li>have it run on lower Android SDK levels</li>

<li>add ActionBarSherlock</li>
</ul>

<h3 id='setting_up_the_skeleton_project'>Setting up the skeleton project.</h3>

<p>I&#8217;m going to be using Eclipse ADT 22 to build the project. We&#8217;ll start by creating a standard Android project using the project wizard.</p>

<p>Our project is going to use the following Android libraries</p>

<ul>
<li>the new Google Maps Android API v2</li>

<li>ActionBarSherlock library</li>
</ul>

<p>Please checkout the resources at the end of the document on how to obtain these projects.</p>

<h3 id='installing_the_library_projects'>Installing the library projects.</h3>

<p>The first thing we need to do is retrieve the library projects.</p>

<ul>
<li>Google Play Services</li>

<li><a href='http://actionbarsherlock.com/'>ActionBarSherlock</a></li>
</ul>

<p>Google Play Services can be downloaded using the android SDK Manager. Navigate to the Extras folder and select Google Play Services.</p>

<p><img alt='Android SDK Manager' src='https://dl.dropboxusercontent.com/u/13246619/Blog%20Articles/GoogleMapsV2/android-sdk-manager.png' /></p>

<p>Google Play Services will be extracted in sdk/extras/google/google_play_services)</p>

<p><strong>Note:</strong> When importing Library projects into your Eclipse workspace, it&#8217;s safer to have them somewhere outside of the current workspace before importing them. Otherwise, you might run into the following error :</p>

<pre><code>Invalid project description.
  /Users/ddewaele/Projects/workspace-android/actionbarsherlock overlaps the location of another project: &#39;actionbarsherlock&#39;</code></pre>

<p>To workaround this problem make sure that before importing the project(s) you simply put them in a location outside of your current workspace, and while importing select the <em>Copy projects into workspce</em> option if you want to have them in your workspace folder.</p>

<p><img alt='Import Android projects eclipse' src='https://dl.dropboxusercontent.com/u/13246619/Blog%20Articles/GoogleMapsV2/import-android-project-eclipse.png' /></p>

<p>We are going to add the library projects into our Eclipse workspace by importing them. Browse to the Google Play Services path in the SDK and import the project. Do the same for ActionBarSherlock. Once both projects compile in your workspace, you can start adding these library projects as dependencies to our project.</p>

<p><img alt='Library dependencies' src='https://dl.dropboxusercontent.com/u/13246619/Blog%20Articles/GoogleMapsV2/library-dependencies.png' /></p>

<h3 id='adt_22_android_private_libraries'>ADT 22 Android Private Libraries</h3>

<p>There&#8217;s an issue with ADT 22 that it sometimes &#8220;forgets&#8221; to export the libraries to your APK. You can verify this by going into your build settings and ensuring that the <code>Android Private Libraries</code> are checked. This will ensure that whatever is stored in your projects <code>libs</code> folder will be properly exported in your APK.</p>

<p><img alt='Android build path' src='./images/android-build-path.png' /></p>

<p>If this is not checked, the Google Play Services library doesn&#8217;t get included in your APK and you won&#8217;t be able to run your app.</p>

<h3 id='adding_the_necessary_permissions'>Adding the necessary permissions</h3>

<p>In order to run Google Maps in your android application, you need to add a set of permissions to your applications manifest.</p>

<p>You need to make sure that the following properties are added. (put them before the starting application tag) :</p>
<div class='highlight'><pre><code class='xml'><span class='c'>&lt;!-- Specify the correct minSDK and targetSDK versions. --&gt;</span>
<span class='nt'>&lt;uses-sdk</span> <span class='na'>android:minSdkVersion=</span><span class='s'>&quot;8&quot;</span> <span class='na'>android:targetSdkVersion=</span><span class='s'>&quot;17&quot;</span><span class='nt'>/&gt;</span>

<span class='c'>&lt;!-- Google Maps related permissions --&gt;</span>
<span class='nt'>&lt;permission</span> <span class='na'>android:name=</span><span class='s'>&quot;com.ecs.google.maps.v2.actionbarsherlock.permission.MAPS_RECEIVE&quot;</span> <span class='na'>android:protectionLevel=</span><span class='s'>&quot;signature&quot;</span><span class='nt'>/&gt;</span>
<span class='nt'>&lt;uses-permission</span> <span class='na'>android:name=</span><span class='s'>&quot;com.example.mapdemo.permission.MAPS_RECEIVE&quot;</span><span class='nt'>/&gt;</span>
 
<span class='c'>&lt;!-- Network connectivity permissions --&gt;</span>
<span class='nt'>&lt;uses-permission</span> <span class='na'>android:name=</span><span class='s'>&quot;android.permission.ACCESS_NETWORK_STATE&quot;</span><span class='nt'>/&gt;</span>
<span class='nt'>&lt;uses-permission</span> <span class='na'>android:name=</span><span class='s'>&quot;android.permission.INTERNET&quot;</span><span class='nt'>/&gt;</span>
 
<span class='c'>&lt;!-- Access Google based webservices --&gt;</span>
<span class='nt'>&lt;uses-permission</span> <span class='na'>android:name=</span><span class='s'>&quot;com.google.android.providers.gsf.permission.READ_GSERVICES&quot;</span><span class='nt'>/&gt;</span>
 
<span class='c'>&lt;!-- External storage for caching. --&gt;</span>
<span class='nt'>&lt;uses-permission</span> <span class='na'>android:name=</span><span class='s'>&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span><span class='nt'>/&gt;</span>

<span class='c'>&lt;!-- My Location --&gt;</span>
<span class='nt'>&lt;uses-permission</span> <span class='na'>android:name=</span><span class='s'>&quot;android.permission.ACCESS_COARSE_LOCATION&quot;</span><span class='nt'>/&gt;</span>
<span class='nt'>&lt;uses-permission</span> <span class='na'>android:name=</span><span class='s'>&quot;android.permission.ACCESS_FINE_LOCATION&quot;</span><span class='nt'>/&gt;</span>

<span class='c'>&lt;!-- Maps API needs OpenGL ES 2.0. --&gt;</span>
<span class='nt'>&lt;uses-feature</span> <span class='na'>android:glEsVersion=</span><span class='s'>&quot;0x00020000&quot;</span> <span class='na'>android:required=</span><span class='s'>&quot;true&quot;</span><span class='nt'>/&gt;</span>   
</code></pre></div>
<h3 id='setting_up_the_map_key'>Setting up the map key</h3>

<p>Inside the application tag we need to specify our map key. This needs to be done by adding a meta-data element inside the application element:</p>

<pre><code>&lt;meta-data android:name=&quot;com.google.android.maps.v2.API_KEY&quot; android:value=&quot;INSERT_YOUR_API_KEY_HERE&quot;/&gt;</code></pre>

<p>The whole proceess of <a href='https://developers.google.com/maps/documentation/android/start#the_google_maps_api_key'>getting a key is described in great length</a> on the Google Android Maps v2 page so I&#8217;m not going to discuss it here. I do highly recommend that you read it to obtain your API key.</p>

<p>I&#8217;ve tried to summarize the process in the picture below, showing you the relationships between</p>

<ul>
<li>The SHA1 fingerprint of your keystore</li>

<li>Your application pacakge name</li>

<li>The API console</li>
</ul>

<p><img alt='Overview picture' src='https://dl.dropboxusercontent.com/u/13246619/Blog%20Articles/GoogleMapsV2/google_maps_key.002.jpg' /></p>

<h3 id='adding_the_map_fragment'>Adding the map fragment</h3>

<p>Assuming you&#8217;ve added the permissions and the API key to your application manifest, we can now start by putting a full-screen map into our application. For the moment we won&#8217;t be worrying about ActionBarSherlock just yet.</p>

<p>In order to add the map to our application we need to do 2 things.</p>

<ul>
<li>Define and add the fragment to the layout</li>

<li>Implement the fragment</li>
</ul>

<p>Adding the fragment to a layout is very simple.</p>

<p>The Google Play Services library provides a simple MapFragment (<code>com.google.android.gms.maps.MapFragment</code>) that can be used out of the box. Note that the <code>MapFragment</code> requires the native API Level 11 fragment implementation, so it&#8217;s only available on devices with API level 11 and higher. Attempting to run the example below on devices with a lower API level will fail with the following error</p>

<pre><code>Caused by: java.lang.ClassNotFoundException: android.view.fragment in loader dalvik.system.PathClassLoader[/data/app/com.ecs.google.maps.v2.actionbarsherlock-2.apk]
	at dalvik.system.PathClassLoader.findClass(PathClassLoader.java:240)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:551)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:511)
	at android.view.LayoutInflater.createView(LayoutInflater.java:471)
	at android.view.LayoutInflater.onCreateView(LayoutInflater.java:549)
	at com.android.internal.policy.impl.PhoneLayoutInflater.onCreateView(PhoneLayoutInflater.java:66)
	at android.view.LayoutInflater.createViewFromTag(LayoutInflater.java:568)
	... 19 more</code></pre>

<p>We&#8217;ll talk about how to run this example on lower API levels in a minute.</p>

<p>For now, we&#8217;ll stick with API level 11 and higher by adding the MapFragmnet to the layout like this :</p>
<div class='highlight'><pre><code class='xml'><span class='nt'>&lt;FrameLayout</span> <span class='na'>xmlns:android=</span><span class='s'>&quot;http://schemas.android.com/apk/res/android&quot;</span>
	<span class='na'>android:id=</span><span class='s'>&quot;@+id/root&quot;</span>
	<span class='na'>android:layout_width=</span><span class='s'>&quot;match_parent&quot;</span>
	<span class='na'>android:layout_height=</span><span class='s'>&quot;match_parent&quot;</span>
	<span class='na'>android:orientation=</span><span class='s'>&quot;horizontal&quot;</span> <span class='nt'>&gt;</span>

<span class='nt'>&lt;fragment</span> <span class='na'>android:id=</span><span class='s'>&quot;@+id/map&quot;</span>
		  <span class='na'>android:layout_width=</span><span class='s'>&quot;match_parent&quot;</span>
		  <span class='na'>android:layout_height=</span><span class='s'>&quot;match_parent&quot;</span>
		  <span class='na'>android:name=</span><span class='s'>&quot;com.google.android.gms.maps.MapFragment&quot;</span><span class='nt'>/&gt;</span>
<span class='nt'>&lt;/FrameLayout&gt;</span> 
</code></pre></div>
<p>Create the activity that will load up the layout above:</p>
<div class='highlight'><pre><code class='java'><span class='kd'>public</span> <span class='kd'>class</span> <span class='nc'>SimpleMapActivity</span> <span class='kd'>extends</span> <span class='n'>Activity</span><span class='o'>{</span>
	
	<span class='kd'>private</span> <span class='n'>com</span><span class='o'>.</span><span class='na'>google</span><span class='o'>.</span><span class='na'>android</span><span class='o'>.</span><span class='na'>gms</span><span class='o'>.</span><span class='na'>maps</span><span class='o'>.</span><span class='na'>MapFragment</span> <span class='n'>mapFragment</span><span class='o'>;</span>
	<span class='kd'>private</span> <span class='n'>GoogleMap</span> <span class='n'>googleMap</span><span class='o'>;</span>

	<span class='nd'>@Override</span>
	<span class='kd'>protected</span> <span class='kt'>void</span> <span class='nf'>onCreate</span><span class='o'>(</span><span class='n'>Bundle</span> <span class='n'>savedInstanceState</span><span class='o'>)</span> <span class='o'>{</span>
		<span class='kd'>super</span><span class='o'>.</span><span class='na'>onCreate</span><span class='o'>(</span><span class='n'>savedInstanceState</span><span class='o'>);</span>
		<span class='n'>setContentView</span><span class='o'>(</span><span class='n'>R</span><span class='o'>.</span><span class='na'>layout</span><span class='o'>.</span><span class='na'>map_fragment</span><span class='o'>);</span>
	<span class='o'>}</span>

<span class='o'>}</span>
</code></pre></div>
<p>Note that in order to interact with the map, you need to get a reference to the GoogleMap object. The GoogleMap object can be retrieved via the MapFragment. In order to get a reference to the MapFragment in an Activity you need to retrieve the FragmentManager using the getFragmentManager call. This call is only available on API level 11 and up so you need to have your minSDK set to 11 if you want to run this.</p>
<div class='highlight'><pre><code class='java'><span class='n'>mapFragment</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>com</span><span class='o'>.</span><span class='na'>google</span><span class='o'>.</span><span class='na'>android</span><span class='o'>.</span><span class='na'>gms</span><span class='o'>.</span><span class='na'>maps</span><span class='o'>.</span><span class='na'>MapFragment</span><span class='o'>)</span> <span class='n'>getFragmentManager</span><span class='o'>().</span><span class='na'>findFragmentById</span><span class='o'>(</span><span class='n'>R</span><span class='o'>.</span><span class='na'>id</span><span class='o'>.</span><span class='na'>map</span><span class='o'>);</span>
<span class='n'>googleMap</span> <span class='o'>=</span> <span class='n'>mapFragment</span><span class='o'>.</span><span class='na'>getMap</span><span class='o'>();</span>
<span class='n'>googleMap</span><span class='o'>.</span><span class='na'>setMyLocationEnabled</span><span class='o'>(</span><span class='kc'>true</span><span class='o'>);</span>		
</code></pre></div>
<h3 id='running_on_lower_api_levels'>Running on lower API levels</h3>

<p>Google also provides a SupportMapFramgment (<code>com.google.android.gms.maps.SupportMapFragment</code>) in Google Play services to be used with the Android Support package&#8217;s backport of fragments. In other words, the SupportMapFragment can be used on Android devices running API 10 and lower, as well as Android devices running 11 and higher.</p>

<p>In order to use the new Google Maps V2 API on older devices we need to do 3 things</p>

<ul>
<li>use a SupportMapFragment instead of a MapFragment in your layout</li>

<li>use a FragmentActivity instead of an Activity</li>

<li>use the SupportFragmentManager instead of the FragmentManager in your FragmentActivity</li>
</ul>

<p>Our layout will now look like this :</p>
<div class='highlight'><pre><code class='xml'><span class='nt'>&lt;FrameLayout</span> <span class='na'>xmlns:android=</span><span class='s'>&quot;http://schemas.android.com/apk/res/android&quot;</span>
	<span class='na'>android:id=</span><span class='s'>&quot;@+id/root&quot;</span>
	<span class='na'>android:layout_width=</span><span class='s'>&quot;match_parent&quot;</span>
	<span class='na'>android:layout_height=</span><span class='s'>&quot;match_parent&quot;</span>
	<span class='na'>android:orientation=</span><span class='s'>&quot;horizontal&quot;</span> <span class='nt'>&gt;</span>

<span class='nt'>&lt;fragment</span>
  <span class='na'>android:id=</span><span class='s'>&quot;@+id/map&quot;</span>
  <span class='na'>android:layout_width=</span><span class='s'>&quot;match_parent&quot;</span>
  <span class='na'>android:layout_height=</span><span class='s'>&quot;match_parent&quot;</span>
  <span class='na'>class=</span><span class='s'>&quot;com.google.android.gms.maps.SupportMapFragment&quot;</span><span class='nt'>/&gt;</span>
<span class='nt'>&lt;/FrameLayout&gt;</span> 
</code></pre></div>
<p>And our FragmentActivity will look like this :</p>
<div class='highlight'><pre><code class='java'><span class='kd'>public</span> <span class='kd'>class</span> <span class='nc'>SimpleMapFragmentActivity</span> <span class='kd'>extends</span> <span class='n'>FragmentActivity</span><span class='o'>{</span>

	<span class='kd'>private</span> <span class='n'>SupportMapFragment</span> <span class='n'>mapFragment</span><span class='o'>;</span>
	<span class='kd'>private</span> <span class='n'>GoogleMap</span> <span class='n'>googleMap</span><span class='o'>;</span>

	<span class='nd'>@Override</span>
	<span class='kd'>protected</span> <span class='kt'>void</span> <span class='nf'>onCreate</span><span class='o'>(</span><span class='n'>Bundle</span> <span class='n'>arg0</span><span class='o'>)</span> <span class='o'>{</span>
		<span class='kd'>super</span><span class='o'>.</span><span class='na'>onCreate</span><span class='o'>(</span><span class='n'>arg0</span><span class='o'>);</span>
		<span class='n'>setContentView</span><span class='o'>(</span><span class='n'>R</span><span class='o'>.</span><span class='na'>layout</span><span class='o'>.</span><span class='na'>support_map_fragment</span><span class='o'>);</span>
		
		<span class='n'>mapFragment</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>SupportMapFragment</span><span class='o'>)</span> <span class='n'>getSupportFragmentManager</span><span class='o'>().</span><span class='na'>findFragmentById</span><span class='o'>(</span><span class='n'>R</span><span class='o'>.</span><span class='na'>id</span><span class='o'>.</span><span class='na'>map</span><span class='o'>);</span>
		<span class='n'>googleMap</span> <span class='o'>=</span> <span class='n'>mapFragment</span><span class='o'>.</span><span class='na'>getMap</span><span class='o'>();</span>
		<span class='n'>googleMap</span><span class='o'>.</span><span class='na'>setMyLocationEnabled</span><span class='o'>(</span><span class='kc'>true</span><span class='o'>);</span>
		
	<span class='o'>}</span>
<span class='o'>}</span>
</code></pre></div>
<p>Important note : Keep in mind that although the <code>MapFragment</code> can run in an <code>Activity</code>, the <code>SupportMapFragment</code> cannot, and needs to run in a <code>FragmentActivity</code>.</p>

<p>Simply let your activity extend from <code>FragmentActivity</code> instead of <code>Activity</code> to resolve this.</p>

<p>If you attempt to run a SupportMapFragment inside an activity, you&#8217;ll get the following error:</p>

<pre><code>Caused by: java.lang.ClassCastException: com.google.android.gms.maps.SupportMapFragment cannot be cast to android.app.Fragment</code></pre>

<h3 id='adding_the_actionbarsherlock'>Adding the ActionBarSherlock.</h3>

<p>The point of this article was to show you how you can include the ActionBarSherlock in your app, so lets get started with that.</p>

<p>With ABS 4.3 it couldn&#8217;t be simpler. Simply have your activity extend SherlockFragmentActivity like this</p>
<div class='highlight'><pre><code class='java'><span class='kd'>public</span> <span class='kd'>class</span> <span class='nc'>SimpleSherlockFragmentActivity</span> <span class='kd'>extends</span> <span class='n'>SherlockFragmentActivity</span> <span class='o'>{</span>

	<span class='kd'>private</span> <span class='n'>SupportMapFragment</span> <span class='n'>mapFragment</span><span class='o'>;</span>
	<span class='kd'>private</span> <span class='n'>GoogleMap</span> <span class='n'>googleMap</span><span class='o'>;</span>

	<span class='nd'>@Override</span>
	<span class='kd'>protected</span> <span class='kt'>void</span> <span class='nf'>onCreate</span><span class='o'>(</span><span class='n'>Bundle</span> <span class='n'>bundle</span><span class='o'>)</span> <span class='o'>{</span>
		<span class='kd'>super</span><span class='o'>.</span><span class='na'>onCreate</span><span class='o'>(</span><span class='n'>bundle</span><span class='o'>);</span>
		<span class='n'>setContentView</span><span class='o'>(</span><span class='n'>R</span><span class='o'>.</span><span class='na'>layout</span><span class='o'>.</span><span class='na'>simple_sherlock_map_fragment</span><span class='o'>);</span>
		
		<span class='n'>mapFragment</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>SupportMapFragment</span><span class='o'>)</span> <span class='n'>getSupportFragmentManager</span><span class='o'>().</span><span class='na'>findFragmentById</span><span class='o'>(</span><span class='n'>R</span><span class='o'>.</span><span class='na'>id</span><span class='o'>.</span><span class='na'>map</span><span class='o'>);</span>
		<span class='n'>googleMap</span> <span class='o'>=</span> <span class='n'>mapFragment</span><span class='o'>.</span><span class='na'>getMap</span><span class='o'>();</span>
		<span class='n'>googleMap</span><span class='o'>.</span><span class='na'>setMyLocationEnabled</span><span class='o'>(</span><span class='kc'>true</span><span class='o'>);</span>

	<span class='o'>}</span>
<span class='o'>}</span>
</code></pre></div>
<p>If you want to include a menu simply add this</p>

<p><div class='highlight'><pre><code class='java'><span class='nd'>@Override</span>
<span class='kd'>public</span> <span class='kt'>boolean</span> <span class='nf'>onCreateOptionsMenu</span><span class='o'>(</span><span class='n'>Menu</span> <span class='n'>menu</span><span class='o'>)</span> <span class='o'>{</span>
  <span class='n'>getSupportMenuInflater</span><span class='o'>().</span><span class='na'>inflate</span><span class='o'>(</span><span class='n'>R</span><span class='o'>.</span><span class='na'>menu</span><span class='o'>.</span><span class='na'>main_menu</span><span class='o'>,</span> <span class='n'>menu</span><span class='o'>);</span>
  <span class='k'>return</span> <span class='kc'>true</span><span class='o'>;</span>
<span class='o'>}</span> 
</code></pre></div></p>

<p>If you want to split the actionbar you&#8217;ll need to add the following option to your activity in the applications manifest.</p>

<pre><code>android:uiOptions=&quot;splitActionBarWhenNarrow&quot;</code></pre>

<h3 id='older_android_version'>Older Android version</h3>

<p>You&#8217;ll also notice that despite using the Android Support Library and Action Bar Sherlock that the app doesn&#8217;t run on older API versions. The application crashes with the following error :</p>

<pre><code>FATAL EXCEPTION: main
java.lang.RuntimeException: Unable to start activity ComponentInfo{com.ecs.google.maps.v2.actionbarsherlock/com.ecs.google.maps.v2.actionbarsherlock.MainActivity}: java.lang.IllegalStateException: You must use Theme.Sherlock, Theme.Sherlock.Light, Theme.Sherlock.Light.DarkActionBar, or a derivative.
	at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:1651)
	at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:1667)
	at android.app.ActivityThread.access$1500(ActivityThread.java:117)
	at android.app.ActivityThread$H.handleMessage(ActivityThread.java:935)
	at android.os.Handler.dispatchMessage(Handler.java:99)
	at android.os.Looper.loop(Looper.java:130)
	at android.app.ActivityThread.main(ActivityThread.java:3687)
	at java.lang.reflect.Method.invokeNative(Native Method)
	at java.lang.reflect.Method.invoke(Method.java:507)
	at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:867)
	at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:625)
	at dalvik.system.NativeStart.main(Native Method)
Caused by: java.lang.IllegalStateException: You must use Theme.Sherlock, Theme.Sherlock.Light, Theme.Sherlock.Light.DarkActionBar, or a derivative.
	at com.actionbarsherlock.internal.ActionBarSherlockCompat.generateLayout(ActionBarSherlockCompat.java:976)
	at com.actionbarsherlock.internal.ActionBarSherlockCompat.installDecor(ActionBarSherlockCompat.java:902)
	at com.actionbarsherlock.internal.ActionBarSherlockCompat.setContentView(ActionBarSherlockCompat.java:836)
	at com.actionbarsherlock.app.SherlockFragmentActivity.setContentView(SherlockFragmentActivity.java:262)
	at com.ecs.google.maps.v2.actionbarsherlock.MainActivity.onCreate(MainActivity.java:25)
	at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1047)
	at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:1615)
	... 11 more</code></pre>

<p>Notice the following in the manifest</p>
<div class='highlight'><pre><code class='xml'><span class='nt'>&lt;application</span>
	<span class='na'>android:allowBackup=</span><span class='s'>&quot;true&quot;</span>
	<span class='na'>android:icon=</span><span class='s'>&quot;@drawable/ic_launcher&quot;</span>
	<span class='na'>android:label=</span><span class='s'>&quot;@string/app_name&quot;</span>
	<span class='na'>android:theme=</span><span class='s'>&quot;@style/AppTheme&quot;</span> <span class='nt'>&gt;</span>
</code></pre></div>
<p>This can be easily fixed by using the Theme.Sherlock in our application.</p>
<div class='highlight'><pre><code class='xml'><span class='nt'>&lt;application</span>
	<span class='na'>android:allowBackup=</span><span class='s'>&quot;true&quot;</span>
	<span class='na'>android:icon=</span><span class='s'>&quot;@drawable/ic_launcher&quot;</span>
	<span class='na'>android:label=</span><span class='s'>&quot;@string/app_name&quot;</span>
	<span class='na'>android:theme=</span><span class='s'>&quot;@style/Theme.Sherlock&quot;</span><span class='nt'>&gt;</span>        
</code></pre></div>
<p>Or even better by specifying your application style in the styles.xml file</p>
<div class='highlight'><pre><code class='xml'>	
	<span class='nt'>&lt;style</span> <span class='na'>name=</span><span class='s'>&quot;AppTheme&quot;</span> <span class='na'>parent=</span><span class='s'>&quot;Theme.Sherlock.Light&quot;</span><span class='nt'>/&gt;</span>
</code></pre></div>
<p>And using it in your application manifest like this:</p>
<div class='highlight'><pre><code class='xml'>    <span class='nt'>&lt;application</span>
        <span class='na'>android:allowBackup=</span><span class='s'>&quot;true&quot;</span>
        <span class='na'>android:icon=</span><span class='s'>&quot;@drawable/ic_launcher&quot;</span>
        <span class='na'>android:label=</span><span class='s'>&quot;@string/app_name&quot;</span>
        <span class='na'>android:theme=</span><span class='s'>&quot;@style/AppTheme&quot;</span> <span class='nt'>&gt;</span>
</code></pre></div>
<h2 id='application_screenshots'>Application screenshots</h2>

<h3 id='android_233'>Android 2.3.3</h3>

<h4 id='gingerbread_simple_map_without_menu'>Gingerbread simple map (without menu)</h4>

<p><img alt='' src='https://dl.dropboxusercontent.com/u/13246619/Blog%20Articles/GoogleMapsV2/gingerbread-simple-map.png' /></p>

<h4 id='gingerbread_simple_map_with_menu'>Gingerbread simple map (with menu)</h4>

<p><img alt='' src='https://dl.dropboxusercontent.com/u/13246619/Blog%20Articles/GoogleMapsV2/gingerbread-simple-map-with-menu.png' /></p>

<h3 id='android_423'>Android 4.2.3</h3>

<h4 id='icsjelly_bean_simple_map_without_menu'>ICS/Jelly Bean simple map (without menu)</h4>

<p><img alt='' src='https://dl.dropboxusercontent.com/u/13246619/Blog%20Articles/GoogleMapsV2/jellybean-simple-map.png' /></p>

<h4 id='icsjelly_bean_simple_map_with_menu'>ICS/Jelly Bean simple map (with menu)</h4>

<p>As you can see, on my Galaxy Nexus I don&#8217;t have a hardware menu button, so as per Google guidelines, the menu overflow icon (3 dots is shown).</p>

<p><img alt='' src='https://dl.dropboxusercontent.com/u/13246619/Blog%20Articles/GoogleMapsV2/jellybean-simple-map-with-menu.png' /></p>

<h2 id='debugging_issues'>Debugging issues</h2>

<p>Logcat is pretty clear</p>

<pre><code>07-06 13:14:46.722: E/Google Maps Android API(28279): Failed to load map. Error contacting Google servers. This is probably an authentication issue (but could be due to network errors).</code></pre>

<h2 id='resources'>Resources</h2>

<ul>
<li><a href='https://developers.google.com/maps/documentation/android/'>Google Maps Android API v2</a></li>

<li><a href='http://actionbarsherlock.com/'>ActionBarSherlock</a></li>

<li>Google Play Services Map Samples (included in the SDK)</li>
</ul>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Googlemapsv2withactionbarsherlock maintained by <a href="https://github.com/ddewaele">ddewaele</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
